<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    <script src="/__/firebase/8.2.2/firebase-app.js"></script>
    <script src="/__/firebase/8.2.2/firebase-firestore.js"></script>
    <script src="/__/firebase/init.js"></script>
    
    <title>Time Capsule</title>
    <body>
        <div id="root"></div>
        <div id="loadData"></div>
        <div class="messageForm">
            <span>Message</span><br>
            <input type="text" id="message" placeholder="message"><br>
            <span>Sender:</span><br>
            <input type="text" id="name" placeholder="name"><br>
            <span>Email:</span><br>
            <input type="text" id="email" placeholder="email"><br>
            <button onclick="insertMessage()">add</button>
        </div>
    </body>
    <script async>
        var insert = () => {};

        function insertMessage() {
            var message = document.getElementById("message").value;
            var name = document.getElementById("name").value;
            var email = document.getElementById("email").value;
            insert(message, name, email);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const loadData = document.querySelector('#loadData');

            const db = firebase.firestore();
            insert = (message, name, email) => {
                db.collection('capsules').add({
                    message,
                    name,
                    email,
                });
            };
            async function getMessages() {
                return await db.collection('capsules').get().then((users) => users.docs.map((u) => (u.data())));
            }
            async function tryLoad() {
                loadData.textContent = JSON.stringify(await getMessages());
            }
            tryLoad();
            // try {
            //   let app = firebase.app();
            //   let features = [
            //     'firestore',
            //   ].filter(feature => typeof app[feature] === 'function');
            //   loadEl.textContent = `Firebase SDK loaded with ${features.join(', ')}`;
            // } catch (e) {
            //   console.error(e);
            //   loadEl.textContent = 'Error loading the Firebase SDK, check the console.';
            // }
        }

    );
    </script>
</html>